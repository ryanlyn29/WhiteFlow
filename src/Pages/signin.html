<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up | Whiteboard Collab</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://kit.fontawesome.com/a2b5c6b5c6.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="../css/sign-in.css" />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Poppins", sans-serif;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-6px); }
      }
    </style>
  </head>

  <body class="text-[#1A1A1A] overflow-hidden bg-white">
    <div id="signin-content" class="flex min-h-screen">
      <!-- LEFT: SIGN UP FORM -->
      <div
        class="flex-1 flex flex-col justify-center px-10 md:px-24 max-w-xl bg-white"
      >
        <h1 class="text-3xl font-semibold mb-2">Create Account</h1>
        <p class="text-gray-500 mb-8 text-sm">
          Sign up to start collaborating on your whiteboard
        </p>

        <!-- Error message -->
        <div id="error-message" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm">
          <i class="fa-solid fa-circle-exclamation mr-2"></i>
          <span id="error-text">An error occurred</span>
        </div>

        <!-- Success message -->
        <div id="success-message" class="hidden mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg text-sm">
          <i class="fa-solid fa-circle-check mr-2"></i>
          <span id="success-text">Account created successfully!</span>
        </div>

         <form id="signup-form" method="POST" action="/signin" class="flex flex-col gap-5 max-w-sm">
          <div>
            <label
              for="name"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Full Name</label
            >
            <input
              id="name"
              name="name"
              type="text"
              placeholder="John Doe"
              required
              class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 hover:border-gray-400 focus:outline-none focus:ring-4 focus:ring-[#5780c0]/20 transition-all duration-300"
            />
          </div>

          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Email</label
            >
            <input
              id="email"
              name="email"
              type="email"
              placeholder="you@example.com"
              required
              class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 hover:border-gray-400 focus:outline-none focus:ring-4 focus:ring-[#5780c0]/20 transition-all duration-300"
            />
          </div>

          <div class="relative">
            <label
              for="password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Password</label
            >
            <input
              id="password"
              name="password"
              type="password"
              placeholder="••••••••"
              required
              minlength="6"
              class="w-full px-4 py-2 pr-10 rounded-xl border-2 border-gray-200 hover:border-gray-400 focus:outline-none focus:ring-4 focus:ring-[#5780c0]/20 transition-all duration-300"
            />
            <button
              type="button"
              id="toggle-password"
              class="absolute right-3 top-1/2 text-gray-500/50 hover:text-gray-700 transition-all duration-300"
            >
              <i class="fa-solid fa-eye"></i>
            </button>
          </div>

          <button
            type="submit"
            id="submit-btn"
            class="mt-2 bg-[#1E1E1E] text-white py-2.5 rounded-full hover:bg-[#698CD1] active:bg-black transition-colors font-medium cursor-pointer"
          >
            Sign Up
          </button>

          <div
            class="flex items-center justify-center gap-2 mt-6 text-gray-500 text-sm"
          >
            <span>Already have an account?</span>
            <a href="./login" class="text-[#4f6de6] font-medium hover:underline">
              Log in
            </a>
          </div>
        </form>
      </div>

      <!-- RIGHT: BOARD -->
      <div
        class="hidden lg:flex flex-1 mt-5 mb-5 mr-5 ml-60 relative items-center justify-center bg-[#1A1A1A] rounded-[2rem] overflow-hidden"
      >
        <!-- Floating pastel blocks -->
        <div
          class="absolute w-64 h-36 bg-[#FFE2E2] rounded-2xl flex flex-col items-start justify-center pl-6 text-[#5C1F1F] font-medium animate-[float_5s_ease-in-out_infinite]"
          style="top: 18%; left: 18%;"
        >
          <i class="fa-solid fa-table-columns mb-2"></i>
          <span>Dashboard</span>
        </div>

        <div
          class="absolute w-60 h-32 bg-[#E2F6FF] rounded-2xl flex flex-col items-start justify-center pl-6 text-[#16384F] font-medium animate-[float_6s_ease-in-out_infinite_1s]"
          style="top: 50%; left: 35%;"
        >
          <i class="fa-solid fa-folder-open mb-2"></i>
          <span>Projects</span>
        </div>

        <div
          class="absolute w-56 h-28 bg-[#FFF9CC] rounded-2xl flex flex-col items-start justify-center pl-6 text-[#4A3A00] font-medium animate-[float_7s_ease-in-out_infinite_2s]"
          style="top: 35%; right: 18%;"
        >
          <i class="fa-solid fa-list-check mb-2"></i>
          <span>Tasks</span>
        </div>

        <div
          class="absolute w-48 h-24 bg-[#E6E2FF] rounded-2xl flex flex-col items-start justify-center pl-5 text-[#2E2172] font-medium animate-[float_8s_ease-in-out_infinite_3s]"
          style="bottom: 20%; left: 20%;"
        >
          <i class="fa-solid fa-note-sticky mb-2"></i>
          <span>Notes</span>
        </div>

        <div
          class="absolute w-52 h-28 bg-[#D8F8E4] rounded-2xl flex flex-col items-start justify-center pl-6 text-[#1B3C28] font-medium animate-[float_9s_ease-in-out_infinite_4s]"
          style="bottom: 15%; right: 25%;"
        >
          <i class="fa-solid fa-user-group mb-2"></i>
          <span>Collab</span>
        </div>
      </div>
    </div>

    <script>
      // Toggle password visibility
      const togglePassword = document.getElementById('toggle-password');
      const passwordInput = document.getElementById('password');
      
      togglePassword.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        const icon = togglePassword.querySelector('i');
        icon.classList.toggle('fa-eye');
        icon.classList.toggle('fa-eye-slash');
      });

      // Handle form submission
      const signupForm = document.getElementById('signup-form');
      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');
      const errorText = document.getElementById('error-text');
      const successText = document.getElementById('success-text');
      const submitBtn = document.getElementById('submit-btn');

      signupForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Hide any previous messages
        errorMessage.classList.add('hidden');
        successMessage.classList.add('hidden');
        
        // Disable submit button and show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating Account...';
        
        // Get form data
        const formData = new FormData(signupForm);
        const data = {
          name: formData.get('name'),
          email: formData.get('email'),
          password: formData.get('password')
        };
        
        try {
          const response = await fetch('/signin', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });
          
          if (response.redirected) {
            // If server sends a redirect, follow it
            window.location.href = response.url;
          } else if (response.ok) {
            // Successful signup
            successText.textContent = 'Account created successfully! Redirecting...';
            successMessage.classList.remove('hidden');
            
            // Redirect after a brief delay
            setTimeout(() => {
              window.location.href = '/mainpage';
            }, 1500);
          } else {
            // Signup failed
            const errorData = await response.text();
            errorText.textContent = errorData || 'Failed to create account. Please try again.';
            errorMessage.classList.remove('hidden');
            
            // Re-enable submit button
            submitBtn.disabled = false;
            submitBtn.textContent = 'Sign Up';
          }
        } catch (error) {
          console.error('Signup error:', error);
          errorText.textContent = 'An error occurred. Please try again.';
          errorMessage.classList.remove('hidden');
          
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.textContent = 'Sign Up';
        }
      });
    </script>
  </body>
</html>