<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Chat Sidebar</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJdZ5pG2n6xN/C6KxV6tLz8A8R3I2Dq9XQz8pD8iC4C5I5qV5H5O5P5O5P5O5Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Custom Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background-color: #2b3037; /* A background color to see the floating widget */
        }
        
        /* Custom Bounce-in Animation */
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            60% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounceIn 0.3s ease-out;
        }

        /* Custom Scrollbar Styling (mimicking the React component's custom scrollbar) */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #2a2a2a;
            border-radius: 9999px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: transparent;
        }

        /* Base styles for the sidebar container */
        #sidebar-container {
            right: 1.25rem; /* right-5 */
            z-index: 10;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow */
            backdrop-filter: blur(4px); /* backdrop-blur-sm */
            overflow: hidden;
            transition: all 500ms ease-in-out;
            background-color: #100C08;
            color: white;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.05em; /* tracking-wider */
            position: fixed;
        }
    </style>
</head>
<body>

    <div id="sidebar-container">
        <!-- Collapsed icon (initial state) -->
        <button id="toggle-collapsed" class="w-full h-full flex items-center justify-center text-white rounded-full bg-[#100C08] hover:bg-[#1b1d20] transition-colors duration-150 cursor-pointer" style="display: none;">
            <!-- faComment icon -->
            <i class="fa-solid fa-comment fa-lg"></i>
        </button>

        <!-- Expanded Sidebar Content -->
        <div id="sidebar-expanded" class="flex flex-col h-full" style="display: none;">
            
            <!-- Header -->
            <div class="flex items-center justify-between px-5 py-3 border-b border-[#1c1e20] bg-[#151313]">
                <span class="font-semibold text-[0.95rem] tracking-wide">
                    Meeting Chat
                </span>
                <!-- Close Button -->
                <button id="toggle-expanded" class="text-gray-400 cursor-pointer hover:text-white p-1 rounded-full hover:bg-[#2a2a2a] transition-all duration-150">
                    <!-- faXmark icon -->
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Messages Area -->
            <div id="messages-container" class="flex-1 flex flex-col overflow-y-auto px-4 py-3 space-y-4 scroll-smooth custom-scrollbar">
                <!-- Messages will be injected here by JavaScript -->
            </div>

            <!-- Input -->
            <div class="p-3 mt-auto bg-[#1a1b1d] border-t border-[#222426] flex items-center relative">
                <input
                    type="text"
                    id="message-input"
                    placeholder="Type a message..."
                    class="w-full px-3 py-2 text-[11px] bg-[#222426] text-gray-200 rounded-full border border-[#3a3d42] focus:outline-none focus:ring-1 focus:ring-blue-500 transition-all placeholder-gray-500"
                />
                <!-- Send Button -->
                <button id="send-button" class="absolute right-6 cursor-pointer bg-blue-500 hover:bg-blue-700 text-white rounded-full transition-all duration-200 shadow-sm p-1.5 leading-none">
                    <!-- faArrowUp icon -->
                    <i class="fa-solid fa-arrow-up text-xs"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- State Variables ---
        let isOpen = false;
        let messages = [];
        
        // --- DOM Elements ---
        const sidebarContainer = document.getElementById('sidebar-container');
        const toggleCollapsedBtn = document.getElementById('toggle-collapsed');
        const toggleExpandedBtn = document.getElementById('toggle-expanded');
        const sidebarExpanded = document.getElementById('sidebar-expanded');
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        // --- Configuration ---
        const defaultMessages = [
            { text: "Hey, did you finish the wireframe?", sender: "A", fromSelf: false },
            { text: "Almost! I’m updating the sticky note layout.", sender: "L", fromSelf: true },
            { text: "Nice — send it over when ready.", sender: "S", fromSelf: false },
        ];
        
        // --- Core Functions ---

        /**
         * Loads messages from localStorage or uses defaults.
         */
        const loadMessages = () => {
            const saved = localStorage.getItem("chatMessages");
            try {
                messages = saved ? JSON.parse(saved) : defaultMessages;
            } catch (e) {
                console.error("Error parsing messages from localStorage:", e);
                messages = defaultMessages;
            }
        };

        /**
         * Saves the current messages array to localStorage.
         */
        const saveMessages = () => {
            localStorage.setItem("chatMessages", JSON.stringify(messages));
        };

        /**
         * Renders all messages to the DOM and scrolls to the bottom.
         */
        const renderMessages = () => {
            messagesContainer.innerHTML = ''; // Clear previous messages
            messages.forEach((msg, i) => {
                // Determine alignment and colors
                const alignClass = msg.fromSelf ? "flex-col items-end" : "flex-col items-start";
                const bubbleClasses = msg.fromSelf
                    ? "bg-blue-600 text-white self-end"
                    : "bg-[#2b3037] text-gray-200 self-start";
                const senderClasses = msg.fromSelf ? "self-end" : "self-start";

                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${alignClass} gap-1 animate-bounce-in w-full`;
                
                // Message Bubble
                const bubble = document.createElement('div');
                bubble.className = `${bubbleClasses} rounded-2xl px-3 py-2 text-[12px] leading-relaxed max-w-[80%] shadow-sm`;
                bubble.textContent = msg.text;

                // Sender Initials
                const senderInitials = document.createElement('div');
                senderInitials.className = `rounded-full flex items-center justify-center text-black text-xs px-2 py-0.5 font-semibold bg-gray-200 ${senderClasses}`;
                senderInitials.textContent = msg.sender;

                messageDiv.appendChild(bubble);
                messageDiv.appendChild(senderInitials);
                messagesContainer.appendChild(messageDiv);
            });

            // Scroll to the bottom of the chat
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        };

        /**
         * Toggles the sidebar's open/closed state and updates styles.
         */
        const onToggle = () => {
            isOpen = !isOpen;
            renderSidebar();
        };

        /**
         * Applies the dynamic sizing styles based on the isOpen state.
         */
        const renderSidebar = () => {
            // Apply main container styles
            sidebarContainer.style.top = isOpen ? "7.5%" : "50%";
            sidebarContainer.style.transform = isOpen ? "translateY(0)" : "translateY(-50%)";
            sidebarContainer.style.width = isOpen ? "20rem" : "2.5rem";
            sidebarContainer.style.height = isOpen ? "90vh" : "2.5rem";
            sidebarContainer.style.borderRadius = isOpen ? "1.25rem" : "50%";
            
            // Show/Hide content based on state
            if (isOpen) {
                toggleCollapsedBtn.style.display = 'none';
                sidebarExpanded.style.display = 'flex';
                // Render messages when opening
                setTimeout(renderMessages, 500); // Give transition time to ensure correct scroll height
            } else {
                toggleCollapsedBtn.style.display = 'flex';
                sidebarExpanded.style.display = 'none';
            }
        };

        /**
         * Handles sending a new message.
         */
        const handleSend = () => {
            const text = messageInput.value.trim();
            if (!text) return;

            const newMessageObj = { text: text, sender: "L", fromSelf: true };
            messages.push(newMessageObj);
            
            messageInput.value = ""; // Clear input
            saveMessages();
            renderMessages();
        };

        // --- Event Listeners & Initialization ---

        window.onload = () => {
            // 1. Load data
            loadMessages();
            
            // 2. Initial render (start in collapsed state as per original styles)
            renderSidebar();

            // 3. Attach listeners
            toggleCollapsedBtn.addEventListener('click', onToggle);
            toggleExpandedBtn.addEventListener('click', onToggle);
            sendButton.addEventListener('click', handleSend);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleSend();
                }
            });

            // Set initial state to collapsed (for the first load)
            isOpen = false;
            renderSidebar(); 
        };
    </script>
</body>
</html>
